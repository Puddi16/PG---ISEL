import pt.isel.canvas.*

data class Smile(val x :Int,val y :Int, val radius :Int =50)

const val delta = 4  // DESLOCAMENTO DO SMILE
const val Radius = 50   // RAIO DO SMILE

const val Width = 600   // LARGURA DO CANVAS
const val Height = 300  // ALTURA DO CANVAS

const val LEFT_ARROW = 37  // CODIGO DA SETA DA ESQUERDA
const val DOWN_ARROW = 38 // CODIGO DA SETA DE BAIXO
const val RIGHT_ARROW = 39  // CODIGO DA SETA DA DIREITA
const val UP_ARROW = 40   // CODIGO DA SETA DE CIMA
const val PLUS = 107    // CODIGO DA TECLA '+'
const val MINUS = 109   // CODIGO DA TECLA '-'

// DESENHAR O SMILE
fun Canvas.drawSmile(smile :Smile) {
    erase()

    drawCircle(smile.x, smile.y, smile.radius, BLACK)   // DESENHAR O CONTORNO

    drawCircle(smile.x, smile.y, (smile.radius*(1-0.07)).toInt(), YELLOW)   // DESENHAR O SMILE AMARELO

    drawCircle(smile.x - (smile.radius*0.35).toInt(),
        smile.y - (smile.radius*0.35).toInt(),
        (smile.radius*0.125).toInt(), BLACK)    // DESENHAR O OLHO ESQUERDO

    drawCircle(smile.x + (smile.radius*0.35).toInt(),
        smile.y - (smile.radius*0.35).toInt(),
        (smile.radius*0.125).toInt(), BLACK)    // DESENHAR O OLHO DIREITO

    drawArc(smile.x, smile.y,
        (smile.radius*0.6).toInt(), 200, 340, BLACK,
        (smile.radius*0.07).toInt())    // DESENHAR A BOCA
}

//MOVER O SMILE USANDO AS SETAS
fun Smile.move(keyCode :Int) :Smile {
    return when (keyCode) {
        //MOVER O SMILE PARA CIMA
        UP_ARROW -> Smile(x,y+delta,radius)
        //MOVER O SMILE PARA A ESQUERDA
        LEFT_ARROW -> Smile(x-delta,y,radius)
        //MOVER O SMILE PARA BAIXO
        DOWN_ARROW -> Smile(x,y-delta,radius)
        //MOVER O SMILE PARA A DIREITA
        RIGHT_ARROW -> Smile(x+delta,y,radius)

        else -> this
    }
}

//AUMENTAR OU DIMINUIR O TAMANHO DO SMILE
fun Smile.resize(keyCode :Int) :Smile {
    return when (keyCode) {
        //AUMENTAR O RAIO DO SMILE
        PLUS -> {
            val rad = radius + 1
            Smile(x,y,rad)
        }
        //DIMINUIR O RAIO DO SMILE
        MINUS -> {
            val rad = if (((radius - 1) * 0.7) >= 10)
            radius - 1
            else radius
            Smile(x,y,rad)
        }
        else -> this
    }
}

fun main() {
    onStart {
        val arena = Canvas(Width,Height,CYAN)
        var smile = Smile(arena.width/2,arena.height/2,Radius)
        arena.drawSmile(smile)

        arena.onMouseDown { mEvent ->
            smile = Smile(mEvent.x,mEvent.y,smile.radius)
            arena.drawSmile(smile)
        }
        arena.onKeyPressed { ke ->
            smile = smile.move(ke.code)
            smile = smile.resize(ke.code)

            arena.drawSmile(smile)
        }
    }
    onFinish{
        println("Done")
    }
}
